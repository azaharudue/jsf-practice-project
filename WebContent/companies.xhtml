<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">


<h:head>
	<meta charset="utf-8" name="viewport"
		content="width=device-width, initial-scale=1" />
	<h:outputStylesheet name="style.css" library="css" />
	<title>Companies</title>


</h:head>

<h:body>



	<!-- Use for a global message  -->
	<p:growl id="growl" redisplay="false" showDetail="true" />

	<h:form id="formCompany">

		<p:toolbar>
			<p:toolbarGroup>

				<!-- Add new Product Button -->
				<p:commandButton value="Add new company" icon="pi pi-plus"
					action="#{companyView.openNew}" update="dlgCompany"
					oncomplete="PF('dlgCompanyWidgetVar').show()"
					styleClass="ui-button-success " style="margin-right: .5rem">

					<p:resetInput target=":formCompany:pnlManageCompanyContent" />
				</p:commandButton>

				<!-- Delete Company Button -->

				<p:commandButton id="delete-companies-button"
					value="#{companyView.deleteButtonMessage}" icon="pi pi-trash"
					action="#{companyView.deleteSelectedCompanies}"
					styleClass="rounded-button ui-button-danger"
					disabled="#{!(companyView.hasSelectedCompanies())}">

					<p:confirm header="Confirmation"
						message="Delete the selected companies?"
						icon="pi pi-exclamation-triangle" />
				</p:commandButton>


			</p:toolbarGroup>
			<!--toolbar caret menu -->
			<p:toolbarGroup align="right" style="width: 10rem">
				<p:splitButton value="Navigate">
					<p:menuitem value="Product details" url="details.xhtml"
						icon="pi pi-external-link" />
					<p:menuitem value="Home(Products)" url="index.xhtml"
						icon="pi pi-home" />
				</p:splitButton>
			</p:toolbarGroup>
		</p:toolbar>


		<!-- Modal for adding a new company -->

		<p:dialog id="dlgCompany" header="Company Details" showEffect="fade"
			modal="true" widgetVar="dlgCompanyWidgetVar" responsive="true">

			<p:outputPanel id="pnlManageCompanyContent" class="ui-fluid"
				rendered="#{ companyView.selectedCompany ne null}">

				<p:messages redisplay="true" />


				<!-- company name -->
				<div class="p-field">
					<p:outputLabel for="companyName" value="Company Name" />
					<p:inputText id="companyName"
						value="#{companyView.selectedCompany.name}" required="true" />
				</div>
				<!-- company location -->
				<div class="p-field">
					<p:outputLabel for="companyLocation" value="Company Location" />
					<p:inputText id="companyLocation"
						value="#{companyView.selectedCompany.location}" required="true" />
				</div>

				<!-- //To do check: List of products to be added for a company? -->

			</p:outputPanel>

			<f:facet name="footer">

				<!-- save  -->
				<p:commandButton value="Save" icon="pi pi-check"
					process="pnlManageCompanyContent @this"
					action="#{companyView.saveCompany}"
					update=" :formCompany:pnlManageCompanyContent"
					>
					<p:resetInput target="pnlManageCompanyContent" />
				</p:commandButton>

				<!-- cancel  -->
				<p:commandButton value="Cancel" icon="pi pi-times"
					onclick="PF('dlgCompanyWidgetVar').hide()"
					class="ui-button-secondary">
					<p:resetInput target=":formCompany:pnlManageCompanyContent" />
				</p:commandButton>
			</f:facet>
		</p:dialog>


		<!-- Data table for companies  -->

		<p:dataTable id="tbl-companies" widgetVar="tblCompaniesWidgetVar"
			var="tblVarCompany" value="#{companyView.companies}" reflow="true"
			selection="#{companyView.selectedCompanies}"
			rowKey="#{tblVarCompany.id}" selectionPageOnly="false"
			paginator="true" styleClass=" ui-datatable-companies" rows="10"
			rowSelectMode="checkbox" paginatorPosition="bottom"
			filteredValue="#{tblWidgetVarProducts}"
			emptyMessage="No products found with given criteria">

			<!-- Ajax events -->

			<p:ajax event="rowEdit" listener="#{companyView.onRowEdit}"
				update=":growl" />
			<p:ajax event="rowEditCancel" listener="#{companyView.onRowCancel}"
				update=":growl" />


			<p:ajax event="rowSelect"
				update=":formCompany:delete-companies-button" />
			<p:ajax event="rowUnselect"
				update=":formCompany:delete-companies-button" />
			<p:ajax event="rowSelectCheckbox"
				update=":formCompany:delete-companies-button" />
			<p:ajax event="rowUnselectCheckbox"
				update=":formCompany:delete-companies-button" />
			<p:ajax event="toggleSelect"
				update=":formCompany:delete-companies-button" />


			<!-- Table header and global filter-->
			<f:facet name="header">
				<p:toolbar>
					<p:toolbarGroup class="p-d-flex p-ai-center p-jc-between">
						<h1>Companies</h1>
						<span align="left"><h:outputText
								value="Total available products :#{companyView.companies.size()}" /></span>
					</p:toolbarGroup>
					<p:toolbarGroup align="right">
						<span><h:outputText value="Search from the table" /></span>
						<span><p:inputText id="globalFilter"
								onkeyup="PF('tblCompaniesWidgetVar').filter()"
								style="width:20rem" placeholder="Enter keyword" /> </span>
					</p:toolbarGroup>
				</p:toolbar>

			</f:facet>
			<!-- Selection -->
			<p:column selectionMode="multiple" exportable="false"
				headerText="Select/Deselect All"
				styleClass="leftAlignedColumnContent" />

			<!-- id-->
			<p:column headerText="ID" styleClass="leftAlignedColumnContent">
				<h:outputText value="#{tblVarCompany.id}" />
			</p:column>



			<!-- Company name -->

			<p:column headerText="Company" sortBy="#{tblVarCompany.name}"
				filterBy="#{tblVarCompany.name}"
				styleClass="leftAlignedColumnContent">
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{tblVarCompany.name}" />
					</f:facet>
					<f:facet name="input">
						<p:inputText value="#{tblVarCompany.name}" style="width:100%"
							label="company name" />
					</f:facet>
				</p:cellEditor>
			</p:column>

			<!-- Company location -->

			<p:column headerText="Company"
				sortBy="#{tblVarProductCompany.location}"
				filterBy="#{tblVarProduct.company.location}"
				styleClass="leftAlignedColumnContent">
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{tblVarCompany.location}" />
					</f:facet>
					<f:facet name="input">
						<p:inputText value="#{tblVarCompany.location}" style="width:100%"
							label="company location" />
					</f:facet>
				</p:cellEditor>
			</p:column>


			<!-- Edit pen -->
			<p:column styleClass="centeredColumnContent"
				headerText="Edit company(*ies)">


				<p:rowEditor id="editrows" editTitle="Edit Row" icon="pi pi-pencil"
					cancelTitle="Cancel Edit" saveTitle="Save Row" />
			</p:column>

			<p:column styleClass="centeredColumnContent"
				headerText="Delete product(s)">
				<p:commandButton class="ui-button-warning rounded-button"
					icon="pi pi-trash" process="@this"
					oncomplete="PF('dlgDeleteCompany').show()">

					<f:setPropertyActionListener value="#{tblVarCompany}"
						target="#{companyView.selectedCompany}" />
				</p:commandButton>




			</p:column>


		</p:dataTable>

		<p:confirmDialog widgetVar="dlgDeleteCompany" showEffect="fade"
			width="300" message="Delete the product?" header="Confirm"
			severity="warn">

			<p:commandButton value="Yes" icon="pi pi-check" process="@this"
				action="#{companyView.deleteCompany}"
				oncomplete="PF('dlgDeleteCompany').hide()" />

			<p:commandButton value="No" type="button"
				styleClass="ui-button-secondary" icon="pi pi-times"
				onclick="PF('dlgDeleteCompany').hide()" />

		</p:confirmDialog>

		<p:confirmDialog global="true" showEffect="fade" width="300">
			<p:commandButton value="Yes" type="button"
				styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
			<p:commandButton value="No" type="button"
				styleClass="ui-confirmdialog-no ui-button-secondary"
				icon="pi pi-times" />
		</p:confirmDialog>

		<!-- TO DO Features. -->
		<!-- 1.  (Dashboard) which company has how many products  -->
		<!-- 2.  (Geo Map) for company locations -->



	</h:form>

</h:body>


</html>